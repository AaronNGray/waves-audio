"use strict";

var _core = require("babel-runtime/core-js")["default"];

// schedulers should be singletons
var Scheduler = require("./scheduler");
var SimpleScheduler = require("./simple-scheduler");
var defaultAudioContext = require("../core/audio-context");
var schedulerMap = new _core.WeakMap();

// scheduler factory
module.exports.getScheduler = function () {
  var audioContext = arguments[0] === undefined ? defaultAudioContext : arguments[0];

  var scheduler = schedulerMap.get(audioContext);

  if (!scheduler) {
    scheduler = new Scheduler({ audioContext: audioContext });
    schedulerMap.set(audioContext, scheduler);
  } else if (scheduler instanceof SimpleScheduler) {
    throw new Error("Scheduler type mismatch for audio context " + audioContext);
  }

  return scheduler;
};

module.exports.getSimpleScheduler = function () {
  var audioContext = arguments[0] === undefined ? defaultAudioContext : arguments[0];

  var simpleScheduler = schedulerMap.get(audioContext);

  if (!simpleScheduler) {
    simpleScheduler = new SimpleScheduler({ audioContext: audioContext });
    schedulerMap.set(audioContext, simpleScheduler);
  } else if (simpleScheduler instanceof Scheduler) {
    throw new Error("Scheduler type mismatch for audio context " + audioContext);
  }

  return simpleScheduler;
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImVzNi91dGlscy9wcmlvcml0eS1xdWV1ZS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUNBLElBQUksU0FBUyxHQUFHLE9BQU8sQ0FBQyxhQUFhLENBQUMsQ0FBQztBQUN2QyxJQUFJLGVBQWUsR0FBRyxPQUFPLENBQUMsb0JBQW9CLENBQUMsQ0FBQztBQUNwRCxJQUFJLG1CQUFtQixHQUFHLE9BQU8sQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDO0FBQzNELElBQUksWUFBWSxHQUFHLFVBQUksT0FBTyxFQUFFLENBQUM7OztBQUdqQyxNQUFNLENBQUMsT0FBTyxDQUFDLFlBQVksR0FBRyxZQUE2QztNQUFwQyxZQUFZLGdDQUFHLG1CQUFtQjs7QUFDdkUsTUFBSSxTQUFTLEdBQUcsWUFBWSxDQUFDLEdBQUcsQ0FBQyxZQUFZLENBQUMsQ0FBQzs7QUFFL0MsTUFBSSxDQUFDLFNBQVMsRUFBRTtBQUNkLGFBQVMsR0FBRyxJQUFJLFNBQVMsQ0FBQyxFQUFDLFlBQVksRUFBRSxZQUFZLEVBQUMsQ0FBQyxDQUFDO0FBQ3hELGdCQUFZLENBQUMsR0FBRyxDQUFDLFlBQVksRUFBRSxTQUFTLENBQUMsQ0FBQztHQUMzQyxNQUFNLElBQUksU0FBUyxZQUFZLGVBQWUsRUFBRTtBQUMvQyxVQUFNLElBQUksS0FBSyxDQUFDLDRDQUE0QyxHQUFHLFlBQVksQ0FBQyxDQUFDO0dBQzlFOztBQUVELFNBQU8sU0FBUyxDQUFDO0NBQ2xCLENBQUM7O0FBRUYsTUFBTSxDQUFDLE9BQU8sQ0FBQyxrQkFBa0IsR0FBRyxZQUE2QztNQUFwQyxZQUFZLGdDQUFHLG1CQUFtQjs7QUFDN0UsTUFBSSxlQUFlLEdBQUcsWUFBWSxDQUFDLEdBQUcsQ0FBQyxZQUFZLENBQUMsQ0FBQzs7QUFFckQsTUFBSSxDQUFDLGVBQWUsRUFBRTtBQUNwQixtQkFBZSxHQUFHLElBQUksZUFBZSxDQUFDLEVBQUMsWUFBWSxFQUFFLFlBQVksRUFBQyxDQUFDLENBQUM7QUFDcEUsZ0JBQVksQ0FBQyxHQUFHLENBQUMsWUFBWSxFQUFFLGVBQWUsQ0FBQyxDQUFDO0dBQ2pELE1BQU0sSUFBSSxlQUFlLFlBQVksU0FBUyxFQUFFO0FBQy9DLFVBQU0sSUFBSSxLQUFLLENBQUMsNENBQTRDLEdBQUcsWUFBWSxDQUFDLENBQUM7R0FDOUU7O0FBRUQsU0FBTyxlQUFlLENBQUM7Q0FDeEIsQ0FBQyIsImZpbGUiOiJlczYvdXRpbHMvcHJpb3JpdHktcXVldWUuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBzY2hlZHVsZXJzIHNob3VsZCBiZSBzaW5nbGV0b25zXG52YXIgU2NoZWR1bGVyID0gcmVxdWlyZSgnLi9zY2hlZHVsZXInKTtcbnZhciBTaW1wbGVTY2hlZHVsZXIgPSByZXF1aXJlKCcuL3NpbXBsZS1zY2hlZHVsZXInKTtcbnZhciBkZWZhdWx0QXVkaW9Db250ZXh0ID0gcmVxdWlyZSgnLi4vY29yZS9hdWRpby1jb250ZXh0Jyk7XG52YXIgc2NoZWR1bGVyTWFwID0gbmV3IFdlYWtNYXAoKTtcblxuLy8gc2NoZWR1bGVyIGZhY3Rvcnlcbm1vZHVsZS5leHBvcnRzLmdldFNjaGVkdWxlciA9IGZ1bmN0aW9uKGF1ZGlvQ29udGV4dCA9IGRlZmF1bHRBdWRpb0NvbnRleHQpIHtcbiAgdmFyIHNjaGVkdWxlciA9IHNjaGVkdWxlck1hcC5nZXQoYXVkaW9Db250ZXh0KTtcblxuICBpZiAoIXNjaGVkdWxlcikge1xuICAgIHNjaGVkdWxlciA9IG5ldyBTY2hlZHVsZXIoe2F1ZGlvQ29udGV4dDogYXVkaW9Db250ZXh0fSk7XG4gICAgc2NoZWR1bGVyTWFwLnNldChhdWRpb0NvbnRleHQsIHNjaGVkdWxlcik7XG4gIH0gZWxzZSBpZiAoc2NoZWR1bGVyIGluc3RhbmNlb2YgU2ltcGxlU2NoZWR1bGVyKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiU2NoZWR1bGVyIHR5cGUgbWlzbWF0Y2ggZm9yIGF1ZGlvIGNvbnRleHQgXCIgKyBhdWRpb0NvbnRleHQpO1xuICB9XG5cbiAgcmV0dXJuIHNjaGVkdWxlcjtcbn07XG5cbm1vZHVsZS5leHBvcnRzLmdldFNpbXBsZVNjaGVkdWxlciA9IGZ1bmN0aW9uKGF1ZGlvQ29udGV4dCA9IGRlZmF1bHRBdWRpb0NvbnRleHQpIHtcbiAgdmFyIHNpbXBsZVNjaGVkdWxlciA9IHNjaGVkdWxlck1hcC5nZXQoYXVkaW9Db250ZXh0KTtcblxuICBpZiAoIXNpbXBsZVNjaGVkdWxlcikge1xuICAgIHNpbXBsZVNjaGVkdWxlciA9IG5ldyBTaW1wbGVTY2hlZHVsZXIoe2F1ZGlvQ29udGV4dDogYXVkaW9Db250ZXh0fSk7XG4gICAgc2NoZWR1bGVyTWFwLnNldChhdWRpb0NvbnRleHQsIHNpbXBsZVNjaGVkdWxlcik7XG4gIH0gZWxzZSBpZiAoc2ltcGxlU2NoZWR1bGVyIGluc3RhbmNlb2YgU2NoZWR1bGVyKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiU2NoZWR1bGVyIHR5cGUgbWlzbWF0Y2ggZm9yIGF1ZGlvIGNvbnRleHQgXCIgKyBhdWRpb0NvbnRleHQpO1xuICB9XG5cbiAgcmV0dXJuIHNpbXBsZVNjaGVkdWxlcjtcbn07XG4iXX0=