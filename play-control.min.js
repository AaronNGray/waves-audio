!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.PlayControl=e()}}(function(){return function e(t,i,n){function r(o,u){if(!i[o]){if(!t[o]){var _="function"==typeof require&&require;if(!u&&_)return _(o,!0);if(s)return s(o,!0);throw new Error("Cannot find module '"+o+"'")}var c=i[o]={exports:{}};t[o][0].call(c.exports,function(e){var i=t[o][1][e];return r(i?i:e)},c,c.exports,e,t,i,n)}return i[o].exports}for(var s="function"==typeof require&&require,o=0;o<n.length;o++)r(n[o]);return r}({1:[function(e,t){var i=window.audioContext||new AudioContext||new webkitAudioContext;window.audioContext=i,t.exports=i},{}],2:[function(e,t){"use strict";var i=function(e,t){return e.__proto__={a:t},e.a===t}({},{}),n=Object.defineProperty,r=Object.getOwnPropertyDescriptor,s=function(e,t){for(var i in t)t.hasOwnProperty(i)&&n(e,i,r(t,i));return e},o=Object.setPrototypeOf||function(e,t){return i?e.__proto__=t:n(e,"__proto__",{value:t,configurable:!0,enumerable:!1,writable:!0}),e},u=Object.create,_=e("../time-engine"),c=(e("../priority-queue"),e("../scheduler")),h=function(e){function t(t){e.call(this),this.__playControl=t}i||s(t,e);var r={};return null!==e&&o(t,e),t.prototype=u(null!==e?e.prototype:null,{constructor:{value:t,configurable:!0,writable:!0}}),n(t,"prototype",{configurable:!1,enumerable:!1,writable:!1}),r.advanceTime=function(e){var t=this.__playControl,i=t.__getPositionAtTime(e),n=t.__transportedEngine.advancePosition(e,i,this.__speed);return t.__getTimeAtPosition(n)},s(t.prototype,r),r=void 0,t}(_),a=function(e){function t(t){var i=this;if(e.call(this),this.__engine=null,this.__scheduledCell=null,this.__time=0,this.__position=0,this.__speed=0,this.__nextPosition=1/0,this.__playingSpeed=1,t.master)throw new Error("object has already been added to a master");var n=(this.__speed,function(){return i.currentTime}),r=function(){return i.currentPosition};if(_.implementsSpeedControlled(t))this.__engine=t,t.setSpeedControlled(this,n,r);else if(_.implementsTransported(t))this.__engine=t,t.setTransported(this,0,function(){var e=arguments[0];if(void 0===e&&(e=null),null===e){var n=c.currentTime,r=i.__getPositionAtTime(n);e=t.syncPosition(n,r,i.__speed)}i.__resetNextPosition(e)},n,r);else{if(!_.implementsScheduled(t))throw new Error("object cannot be added to play control");this.__scheduledEngine=t,c.add(t,1/0,r)}}function r(){return c.currentTime}function a(){return this.__position+(c.currentTime-this.__time)*this.__speed}function d(e){var t=this.__sync();e>=0?.0625>e?e=.0625:e>16&&(e=16):-16>e?e=-16:e>-.0625&&(e=-.0625),this.__playingSpeed=e,0!==this.__speed&&this.syncSpeed(t,this.__position,e)}function l(){return this.__playingSpeed}i||s(t,e);var p={};return null!==e&&o(t,e),t.prototype=u(null!==e?e.prototype:null,{constructor:{value:t,configurable:!0,writable:!0},currentTime:{get:r,configurable:!0,enumerable:!0},currentPosition:{get:a,configurable:!0,enumerable:!0},speed:{get:l,set:d,configurable:!0,enumerable:!0}}),n(t,"prototype",{configurable:!1,enumerable:!1,writable:!1}),p.__getTimeAtPosition=function(e){return this.__time+(e-this.__position)/this.__speed},p.__getPositionAtTime=function(e){return this.__position+(e-this.__time)*this.__speed},p.__sync=function(){var e=this.currentTime;return this.__position+=(e-this.__time)*this.__speed,this.__time=e,e},p.__resetNextPosition=function(e){this.__scheduledCell&&this.__scheduledCell.resetNextTime(this.__getTimeAtPosition(e)),this.__nextPosition=e},p.syncSpeed=function(e,t,i){var n=arguments[3];void 0===n&&(n=!1);var r=this.__speed;if(this.__time=e,this.__position=t,this.__speed=i,i!==r||n)switch(this.__engine.interface){case"speed-controlled":this.__engine.syncSpeed(e,t,i,n);break;case"transported":var s=this.__nextPosition;n?s=this.__transportedEngine.syncPosition(this.__time,this.__position,i):0===r?(s=this.__transportedEngine.syncPosition(this.__time,this.__position,i),this.__scheduledCell=new h(this),c.add(this.__scheduledCell,1/0)):0===i?(s=1/0,c.remove(this.__scheduledCell),this.__scheduledCell=null):0>i*r&&(s=this.__transportedEngine.syncPosition(e,t,i)),this.__resetNextPosition(s);break;case"scheduled":0===r?this.__scheduledEngine.resetNextTime(0):0===i&&this.__scheduledEngine.resetNextTime(1/0)}},p.start=function(){var e=this.__sync();this.syncSpeed(e,this.__position,this.__playingSpeed)},p.pause=function(){var e=this.__sync();this.syncSpeed(e,this.__position,0)},p.stop=function(){var e=this.__sync();this.syncSpeed(e,this.__position,0),this.seek(0)},p.seek=function(e){if(e!==this.__position){var t=this.__sync();this.__position=e,this.syncSpeed(t,e,this.__speed,!0)}},p.clear=function(){var e=this.__sync();switch(this.syncSpeed(e,this.__position,0),this.__engine.interface){case"speed-controlled":this.__engine.resetSpeedControlled();break;case"transported":this.__engine.resetTransported();break;case"scheduled":this.__engine.resetScheduled()}},s(t.prototype,p),p=void 0,t}(_);t.exports=a},{"../priority-queue":3,"../scheduler":4,"../time-engine":5}],3:[function(e,t){"use strict";var i=function(){function e(){this.__objects=[],this.reverse=!1}function t(){return this.__objects[0][0]}var i=(function(e,t){return e.__proto__={a:t},e.a===t}({},{}),Object.defineProperty),n=Object.getOwnPropertyDescriptor,r=function(e,t){for(var r in t)t.hasOwnProperty(r)&&i(e,r,n(t,r));return e},s=Object.defineProperties,o={};return s(e.prototype,{head:{get:t,configurable:!0,enumerable:!0}}),i(e,"prototype",{configurable:!1,enumerable:!1,writable:!1}),o.__objectIndex=function(e){for(var t=0;t<this.__objects.length;t++)if(e===this.__objects[t][0])return t;return-1},o.__removeObject=function(e){var t=this.__objectIndex(e);return t>=0&&this.__objects.splice(t,1),this.__objects.length>0?this.__objects[0][1]:1/0},o.__sortObjects=function(){this.reverse?this.__objects.sort(function(e,t){return t[1]-e[1]}):this.__objects.sort(function(e,t){return e[1]-t[1]})},o.insert=function(e,t){var i=arguments[2];return void 0===i&&(i=!0),1/0!==t&&t!=-1/0?(this.__objects.push([e,t]),i&&this.__sortObjects(),this.__objects[0][1]):this.__removeObject(e)},o.move=function(e,t){if(1/0!==t&&t!=-1/0){var i=this.__objectIndex(e);return 0>i?this.__objects.push([e,t]):this.__objects[i][1]=t,this.__sortObjects(),this.__objects[0][1]}return this.__removeObject(e)},o.remove=function(e){return this.__removeObject(e)},o.clear=function(){return this.__objects.length=0,1/0},r(e.prototype,o),o=void 0,e}();t.exports=i},{}],4:[function(e,t){"use strict";function i(e,t){var i=e.indexOf(t);return i>=0?(e.splice(i,1),!0):!1}var n=e("../audio-context"),r=e("../priority-queue"),s=e("../time-engine"),o=function(){function e(){this.__queue=new r,this.__scheduledEngines=[],this.__currentTime=null,this.__nextTime=1/0,this.__timeout=null,this.period=.025,this.lookahead=.1}function t(){return this.__currentTime||n.currentTime+this.lookahead}var o=(function(e,t){return e.__proto__={a:t},e.a===t}({},{}),Object.defineProperty),u=Object.getOwnPropertyDescriptor,_=function(e,t){for(var i in t)t.hasOwnProperty(i)&&o(e,i,u(t,i));return e},c=Object.defineProperties,h={};return c(e.prototype,{currentTime:{get:t,configurable:!0,enumerable:!0}}),o(e,"prototype",{configurable:!1,enumerable:!1,writable:!1}),h.__tick=function(){for(var e=this;this.__nextTime<=n.currentTime+this.lookahead;){this.__currentTime=this.__nextTime;var t=this.__queue.head,i=Math.max(t.advanceTime(this.__currentTime),this.__currentTime);this.__nextTime=this.__queue.move(t,i)}this.__currentTime=null,this.__timeout=null,1/0!==this.__nextTime&&(this.__timeout=setTimeout(function(){e.__tick()},1e3*this.period))},h.__reschedule=function(){1/0!==this.__nextTime?this.__timeout||this.__tick():this.__timeout&&(clearTimeout(this.__timeout),this.__timeout=null)},h.callback=function(e){var t=arguments[1];void 0===t&&(t=0);var i=arguments[2];void 0===i&&(i=0);var n={period:t||1/0,advanceTime:function(t,i){return e(t,i),t+this.period}};return this.__nextTime=this.__queue.insert(n,this.currentTime+i),this.__reschedule(),n},h.add=function(e){var t=arguments[1];void 0===t&&(t=0);var i=arguments[2];void 0===i&&(i=null);var n=this;if(e.master)throw new Error("object has already been added to a master");if(!s.implementsScheduled(e))throw new Error("object cannot be added to scheduler");this.__scheduledEngines.push(e),e.setScheduled(this,function(t){n.__nextTime=n.__queue.move(e,t),n.__reschedule()},function(){return n.currentTime},i),this.__nextTime=this.__queue.insert(e,this.currentTime+t),this.__reschedule()},h.remove=function(e){if(!i(this.__scheduledEngines,e))throw new Error("object has not been added to this scheduler");e.resetScheduled(),this.__nextTime=this.__queue.remove(e),this.__reschedule()},h.reset=function(e,t){if(e.master!==this)throw new Error("object has not been added to this scheduler");this.__nextTime=this.__queue.move(e,t),this.__reschedule()},_(e.prototype,h),h=void 0,e}();t.exports=new o},{"../audio-context":1,"../priority-queue":3,"../time-engine":5}],5:[function(e,t){"use strict";var i=e("../audio-context"),n=function(){function e(){this.master=null,this.interface=null,this.transportStartPosition=0,this.outputNode=null}function t(){return i.currentTime}function n(){return 0}var r=Object.defineProperty,s=function(e,t){for(var i in t)t.hasOwnProperty(i)&&r(e,i,Object.getOwnPropertyDescriptor(t,i));return e},o={};return Object.defineProperties(e.prototype,{currentTime:{get:t,configurable:!0,enumerable:!0},currentPosition:{get:n,configurable:!0,enumerable:!0}}),r(e,"prototype",{configurable:!1,enumerable:!1,writable:!1}),o.resetNextTime=function(){var e=arguments[0];void 0===e&&(e=null)},o.resetNextPosition=function(){var e=arguments[0];void 0===e&&(e=null)},o.__setGetters=function(e,t){e&&Object.defineProperty(this,"currentTime",{configurable:!0,get:e,set:function(){}}),t&&Object.defineProperty(this,"currentPosition",{configurable:!0,get:t,set:function(){}})},o.__deleteGetters=function(){delete this.currentTime,delete this.currentPosition},o.setScheduled=function(e,t,i,n){this.master=e,this.interface="scheduled",this.__setGetters(i,n),t&&(this.resetNextTime=t)},o.resetScheduled=function(){this.__deleteGetters(),delete this.resetNextTime,this.master=null,this.interface=null},o.setTransported=function(e,t,i,n,r){this.master=e,this.interface="transported",this.transportStartPosition=t,this.__setGetters(n,r),i&&(this.resetNextPosition=i)},o.resetTransported=function(){this.__deleteGetters(),delete this.resetNextPosition,this.transportStartPosition=0,this.master=null,this.interface=null},o.setSpeedControlled=function(e,t,i){this.master=e,this.interface="speed-controlled",this.__setGetters(t,i)},o.resetSpeedControlled=function(){this.__deleteGetters(),this.master=null,this.interface=null},o.removeFromMaster=function(){this.master&&this.master.remove(this)},o.connect=function(e){return this.outputNode.connect(e),this},o.disconnect=function(e){return this.outputNode.disconnect(e),this},s(e.prototype,o),o=void 0,e}();n.implementsScheduled=function(e){return e.advanceTime&&e.advanceTime instanceof Function},n.implementsTransported=function(e){return e.syncPosition&&e.syncPosition instanceof Function&&e.advancePosition&&e.advancePosition instanceof Function},n.implementsSpeedControlled=function(e){return e.syncSpeed&&e.syncSpeed instanceof Function},t.exports=n},{"../audio-context":1}]},{},[2])(2)});