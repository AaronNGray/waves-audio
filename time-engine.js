!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var n;"undefined"!=typeof window?n=window:"undefined"!=typeof global?n=global:"undefined"!=typeof self&&(n=self),n.TimeEngine=e()}}(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
/* Copyright 2013 Chris Wilson

   Licensed under the Apache License, Version 2.0 (the "License");
   you may not use this file except in compliance with the License.
   You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

   Unless required by applicable law or agreed to in writing, software
   distributed under the License is distributed on an "AS IS" BASIS,
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   See the License for the specific language governing permissions and
   limitations under the License.
*/

/* 

This monkeypatch library is intended to be included in projects that are
written to the proper AudioContext spec (instead of webkitAudioContext), 
and that use the new naming and proper bits of the Web Audio API (e.g. 
using BufferSourceNode.start() instead of BufferSourceNode.noteOn()), but may
have to run on systems that only support the deprecated bits.

This library should be harmless to include if the browser supports 
unprefixed "AudioContext", and/or if it supports the new names.  

The patches this library handles:
if window.AudioContext is unsupported, it will be aliased to webkitAudioContext().
if AudioBufferSourceNode.start() is unimplemented, it will be routed to noteOn() or
noteGrainOn(), depending on parameters.

The following aliases only take effect if the new names are not already in place:

AudioBufferSourceNode.stop() is aliased to noteOff()
AudioContext.createGain() is aliased to createGainNode()
AudioContext.createDelay() is aliased to createDelayNode()
AudioContext.createScriptProcessor() is aliased to createJavaScriptNode()
AudioContext.createPeriodicWave() is aliased to createWaveTable()
OscillatorNode.start() is aliased to noteOn()
OscillatorNode.stop() is aliased to noteOff()
OscillatorNode.setPeriodicWave() is aliased to setWaveTable()
AudioParam.setTargetAtTime() is aliased to setTargetValueAtTime()

This library does NOT patch the enumerated type changes, as it is 
recommended in the specification that implementations support both integer
and string types for AudioPannerNode.panningModel, AudioPannerNode.distanceModel 
BiquadFilterNode.type and OscillatorNode.type.

*/
(function (global, exports, perf) {
  'use strict';

  function fixSetTarget(param) {
    if (!param) // if NYI, just return
      return;
    if (!param.setTargetAtTime)
      param.setTargetAtTime = param.setTargetValueAtTime; 
  }

  if (window.hasOwnProperty('webkitAudioContext') && 
      !window.hasOwnProperty('AudioContext')) {
    window.AudioContext = webkitAudioContext;

    if (!AudioContext.prototype.hasOwnProperty('createGain'))
      AudioContext.prototype.createGain = AudioContext.prototype.createGainNode;
    if (!AudioContext.prototype.hasOwnProperty('createDelay'))
      AudioContext.prototype.createDelay = AudioContext.prototype.createDelayNode;
    if (!AudioContext.prototype.hasOwnProperty('createScriptProcessor'))
      AudioContext.prototype.createScriptProcessor = AudioContext.prototype.createJavaScriptNode;
    if (!AudioContext.prototype.hasOwnProperty('createPeriodicWave'))
      AudioContext.prototype.createPeriodicWave = AudioContext.prototype.createWaveTable;


    AudioContext.prototype.internal_createGain = AudioContext.prototype.createGain;
    AudioContext.prototype.createGain = function() { 
      var node = this.internal_createGain();
      fixSetTarget(node.gain);
      return node;
    };

    AudioContext.prototype.internal_createDelay = AudioContext.prototype.createDelay;
    AudioContext.prototype.createDelay = function(maxDelayTime) { 
      var node = maxDelayTime ? this.internal_createDelay(maxDelayTime) : this.internal_createDelay();
      fixSetTarget(node.delayTime);
      return node;
    };

    AudioContext.prototype.internal_createBufferSource = AudioContext.prototype.createBufferSource;
    AudioContext.prototype.createBufferSource = function() { 
      var node = this.internal_createBufferSource();
      if (!node.start) {
        node.start = function ( when, offset, duration ) {
          if ( offset || duration )
            this.noteGrainOn( when, offset, duration );
          else
            this.noteOn( when );
        };
      }
      if (!node.stop)
        node.stop = node.noteOff;
      fixSetTarget(node.playbackRate);
      return node;
    };

    AudioContext.prototype.internal_createDynamicsCompressor = AudioContext.prototype.createDynamicsCompressor;
    AudioContext.prototype.createDynamicsCompressor = function() { 
      var node = this.internal_createDynamicsCompressor();
      fixSetTarget(node.threshold);
      fixSetTarget(node.knee);
      fixSetTarget(node.ratio);
      fixSetTarget(node.reduction);
      fixSetTarget(node.attack);
      fixSetTarget(node.release);
      return node;
    };

    AudioContext.prototype.internal_createBiquadFilter = AudioContext.prototype.createBiquadFilter;
    AudioContext.prototype.createBiquadFilter = function() { 
      var node = this.internal_createBiquadFilter();
      fixSetTarget(node.frequency);
      fixSetTarget(node.detune);
      fixSetTarget(node.Q);
      fixSetTarget(node.gain);
      return node;
    };

    if (AudioContext.prototype.hasOwnProperty( 'createOscillator' )) {
      AudioContext.prototype.internal_createOscillator = AudioContext.prototype.createOscillator;
      AudioContext.prototype.createOscillator = function() { 
        var node = this.internal_createOscillator();
        if (!node.start)
          node.start = node.noteOn; 
        if (!node.stop)
          node.stop = node.noteOff;
        if (!node.setPeriodicWave)
          node.setPeriodicWave = node.setWaveTable;
        fixSetTarget(node.frequency);
        fixSetTarget(node.detune);
        return node;
      };
    }
  }
}(window));
},{}],2:[function(require,module,exports){
/*globals AudioContext*/
require('./ac-monkeypatch');
module.exports = new AudioContext();
},{"./ac-monkeypatch":1}],3:[function(require,module,exports){
"use strict";
"use strict";
var audioContext = require("audio-context");
var TimeEngine = function TimeEngine() {
  this.interface = null;
  this.outputNode = null;
};
($traceurRuntime.createClass)(TimeEngine, {
  get currentTime() {
    return audioContext.currentTime;
  },
  get currentPosition() {
    return 0;
  },
  resetNextTime: function() {
    var time = arguments[0] !== (void 0) ? arguments[0] : null;
  },
  resetNextPosition: function() {
    var position = arguments[0] !== (void 0) ? arguments[0] : null;
  },
  __setGetters: function(getCurrentTime, getCurrentPosition) {
    if (getCurrentTime) {
      Object.defineProperty(this, 'currentTime', {
        configurable: true,
        get: getCurrentTime
      });
    }
    if (getCurrentPosition) {
      Object.defineProperty(this, 'currentPosition', {
        configurable: true,
        get: getCurrentPosition
      });
    }
  },
  __deleteGetters: function() {
    delete this.currentTime;
    delete this.currentPosition;
  },
  connect: function(target) {
    this.outputNode.connect(target);
    return this;
  },
  disconnect: function(connection) {
    this.outputNode.disconnect(connection);
    return this;
  }
}, {});
TimeEngine.implementsScheduled = function(engine) {
  return (engine.advanceTime && engine.advanceTime instanceof Function);
};
TimeEngine.implementsTransported = function(engine) {
  return (engine.syncPosition && engine.syncPosition instanceof Function && engine.advancePosition && engine.advancePosition instanceof Function);
};
TimeEngine.implementsSpeedControlled = function(engine) {
  return (engine.syncSpeed && engine.syncSpeed instanceof Function);
};
TimeEngine.setScheduled = function(engine, resetNextTime, getCurrentTime, getCurrentPosition) {
  engine.interface = "scheduled";
  engine.__setGetters(getCurrentTime, getCurrentPosition);
  if (resetNextTime)
    engine.resetNextTime = resetNextTime;
};
TimeEngine.setTransported = function(engine, resetNextPosition, getCurrentTime, getCurrentPosition) {
  engine.interface = "transported";
  engine.__setGetters(getCurrentTime, getCurrentPosition);
  if (resetNextPosition)
    engine.resetNextPosition = resetNextPosition;
};
TimeEngine.setSpeedControlled = function(engine, getCurrentTime, getCurrentPosition) {
  engine.interface = "speed-controlled";
  engine.__setGetters(getCurrentTime, getCurrentPosition);
};
TimeEngine.resetInterface = function(engine) {
  engine.__deleteGetters();
  delete engine.resetNextTime;
  delete engine.resetNextPosition;
  engine.interface = null;
};
module.exports = TimeEngine;


//# sourceURL=/Users/goldszmidt/sam/pro/dev/time-engine/time-engine.es6.js
},{"audio-context":2}]},{},[3])(3)
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJub2RlX21vZHVsZXMvYXVkaW8tY29udGV4dC9hYy1tb25rZXlwYXRjaC5qcyIsIm5vZGVfbW9kdWxlcy9hdWRpby1jb250ZXh0L2F1ZGlvLWNvbnRleHQuanMiLCIvVXNlcnMvZ29sZHN6bWlkdC9zYW0vcHJvL2Rldi90aW1lLWVuZ2luZS90aW1lLWVuZ2luZS5lczYuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUNBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FB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LEtBQUksYUFBWTtBQUNkLFNBQUssY0FBYyxFQUFJLGNBQVksQ0FBQztBQUFBLEFBQ3hDLENBQUM7QUFFRCxTQUFTLGVBQWUsRUFBSSxVQUFTLE1BQUssQ0FBRyxDQUFBLGlCQUFnQixDQUFHLENBQUEsY0FBYSxDQUFHLENBQUEsa0JBQWlCLENBQUc7QUFDbEcsT0FBSyxVQUFVLEVBQUksY0FBWSxDQUFDO0FBQ2hDLE9BQUssYUFBYSxBQUFDLENBQUMsY0FBYSxDQUFHLG1CQUFpQixDQUFDLENBQUM7QUFDdkQsS0FBSSxpQkFBZ0I7QUFDbEIsU0FBSyxrQkFBa0IsRUFBSSxrQkFBZ0IsQ0FBQztBQUFBLEFBQ2hELENBQUM7QUFFRCxTQUFTLG1CQUFtQixFQUFJLFVBQVMsTUFBSyxDQUFHLENBQUEsY0FBYSxDQUFHLENBQUEsa0JBQWlCLENBQUc7QUFDbkYsT0FBSyxVQUFVLEVBQUksbUJBQWlCLENBQUM7QUFDckMsT0FBSyxhQUFhLEFBQUMsQ0FBQyxjQUFhLENBQUcsbUJBQWlCLENBQUMsQ0FBQztBQUN6RCxDQUFDO0FBRUQsU0FBUyxlQUFlLEVBQUksVUFBUyxNQUFLLENBQUc7QUFDM0MsT0FBSyxnQkFBZ0IsQUFBQyxFQUFDLENBQUM7QUFDeEIsT0FBTyxPQUFLLGNBQWMsQ0FBQztBQUMzQixPQUFPLE9BQUssa0JBQWtCLENBQUM7QUFDL0IsT0FBSyxVQUFVLEVBQUksS0FBRyxDQUFDO0FBQ3pCLENBQUM7QUFFRCxLQUFLLFFBQVEsRUFBSSxXQUFTLENBQUM7QUFDM0IiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiLyogQ29weXJpZ2h0IDIwMTMgQ2hyaXMgV2lsc29uXG5cbiAgIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gICB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gICBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcblxuICAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuXG4gICBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gICBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gICBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAgIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAgIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuKi9cblxuLyogXG5cblRoaXMgbW9ua2V5cGF0Y2ggbGlicmFyeSBpcyBpbnRlbmRlZCB0byBiZSBpbmNsdWRlZCBpbiBwcm9qZWN0cyB0aGF0IGFyZVxud3JpdHRlbiB0byB0aGUgcHJvcGVyIEF1ZGlvQ29udGV4dCBzcGVjIChpbnN0ZWFkIG9mIHdlYmtpdEF1ZGlvQ29udGV4dCksIFxuYW5kIHRoYXQgdXNlIHRoZSBuZXcgbmFtaW5nIGFuZCBwcm9wZXIgYml0cyBvZiB0aGUgV2ViIEF1ZGlvIEFQSSAoZS5nLiBcbnVzaW5nIEJ1ZmZlclNvdXJjZU5vZGUuc3RhcnQoKSBpbnN0ZWFkIG9mIEJ1ZmZlclNvdXJjZU5vZGUubm90ZU9uKCkpLCBidXQgbWF5XG5oYXZlIHRvIHJ1biBvbiBzeXN0ZW1zIHRoYXQgb25seSBzdXBwb3J0IHRoZSBkZXByZWNhdGVkIGJpdHMuXG5cblRoaXMgbGlicmFyeSBzaG91bGQgYmUgaGFybWxlc3MgdG8gaW5jbHVkZSBpZiB0aGUgYnJvd3NlciBzdXBwb3J0cyBcbnVucHJlZml4ZWQgXCJBdWRpb0NvbnRleHRcIiwgYW5kL29yIGlmIGl0IHN1cHBvcnRzIHRoZSBuZXcgbmFtZXMuICBcblxuVGhlIHBhdGNoZXMgdGhpcyBsaWJyYXJ5IGhhbmRsZXM6XG5pZiB3aW5kb3cuQXVkaW9Db250ZXh0IGlzIHVuc3VwcG9ydGVkLCBpdCB3aWxsIGJlIGFsaWFzZWQgdG8gd2Via2l0QXVkaW9Db250ZXh0KCkuXG5pZiBBdWRpb0J1ZmZlclNvdXJjZU5vZGUuc3RhcnQoKSBpcyB1bmltcGxlbWVudGVkLCBpdCB3aWxsIGJlIHJvdXRlZCB0byBub3RlT24oKSBvclxubm90ZUdyYWluT24oKSwgZGVwZW5kaW5nIG9uIHBhcmFtZXRlcnMuXG5cblRoZSBmb2xsb3dpbmcgYWxpYXNlcyBvbmx5IHRha2UgZWZmZWN0IGlmIHRoZSBuZXcgbmFtZXMgYXJlIG5vdCBhbHJlYWR5IGluIHBsYWNlOlxuXG5BdWRpb0J1ZmZlclNvdXJjZU5vZGUuc3RvcCgpIGlzIGFsaWFzZWQgdG8gbm90ZU9mZigpXG5BdWRpb0NvbnRleHQuY3JlYXRlR2FpbigpIGlzIGFsaWFzZWQgdG8gY3JlYXRlR2Fpbk5vZGUoKVxuQXVkaW9Db250ZXh0LmNyZWF0ZURlbGF5KCkgaXMgYWxpYXNlZCB0byBjcmVhdGVEZWxheU5vZGUoKVxuQXVkaW9Db250ZXh0LmNyZWF0ZVNjcmlwdFByb2Nlc3NvcigpIGlzIGFsaWFzZWQgdG8gY3JlYXRlSmF2YVNjcmlwdE5vZGUoKVxuQXVkaW9Db250ZXh0LmNyZWF0ZVBlcmlvZGljV2F2ZSgpIGlzIGFsaWFzZWQgdG8gY3JlYXRlV2F2ZVRhYmxlKClcbk9zY2lsbGF0b3JOb2RlLnN0YXJ0KCkgaXMgYWxpYXNlZCB0byBub3RlT24oKVxuT3NjaWxsYXRvck5vZGUuc3RvcCgpIGlzIGFsaWFzZWQgdG8gbm90ZU9mZigpXG5Pc2NpbGxhdG9yTm9kZS5zZXRQZXJpb2RpY1dhdmUoKSBpcyBhbGlhc2VkIHRvIHNldFdhdmVUYWJsZSgpXG5BdWRpb1BhcmFtLnNldFRhcmdldEF0VGltZSgpIGlzIGFsaWFzZWQgdG8gc2V0VGFyZ2V0VmFsdWVBdFRpbWUoKVxuXG5UaGlzIGxpYnJhcnkgZG9lcyBOT1QgcGF0Y2ggdGhlIGVudW1lcmF0ZWQgdHlwZSBjaGFuZ2VzLCBhcyBpdCBpcyBcbnJlY29tbWVuZGVkIGluIHRoZSBzcGVjaWZpY2F0aW9uIHRoYXQgaW1wbGVtZW50YXRpb25zIHN1cHBvcnQgYm90aCBpbnRlZ2VyXG5hbmQgc3RyaW5nIHR5cGVzIGZvciBBdWRpb1Bhbm5lck5vZGUucGFubmluZ01vZGVsLCBBdWRpb1Bhbm5lck5vZGUuZGlzdGFuY2VNb2RlbCBcbkJpcXVhZEZpbHRlck5vZGUudHlwZSBhbmQgT3NjaWxsYXRvck5vZGUudHlwZS5cblxuKi9cbihmdW5jdGlvbiAoZ2xvYmFsLCBleHBvcnRzLCBwZXJmKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICBmdW5jdGlvbiBmaXhTZXRUYXJnZXQocGFyYW0pIHtcbiAgICBpZiAoIXBhcmFtKSAvLyBpZiBOWUksIGp1c3QgcmV0dXJuXG4gICAgICByZXR1cm47XG4gICAgaWYgKCFwYXJhbS5zZXRUYXJnZXRBdFRpbWUpXG4gICAgICBwYXJhbS5zZXRUYXJnZXRBdFRpbWUgPSBwYXJhbS5zZXRUYXJnZXRWYWx1ZUF0VGltZTsgXG4gIH1cblxuICBpZiAod2luZG93Lmhhc093blByb3BlcnR5KCd3ZWJraXRBdWRpb0NvbnRleHQnKSAmJiBcbiAgICAgICF3aW5kb3cuaGFzT3duUHJvcGVydHkoJ0F1ZGlvQ29udGV4dCcpKSB7XG4gICAgd2luZG93LkF1ZGlvQ29udGV4dCA9IHdlYmtpdEF1ZGlvQ29udGV4dDtcblxuICAgIGlmICghQXVkaW9Db250ZXh0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eSgnY3JlYXRlR2FpbicpKVxuICAgICAgQXVkaW9Db250ZXh0LnByb3RvdHlwZS5jcmVhdGVHYWluID0gQXVkaW9Db250ZXh0LnByb3RvdHlwZS5jcmVhdGVHYWluTm9kZTtcbiAgICBpZiAoIUF1ZGlvQ29udGV4dC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkoJ2NyZWF0ZURlbGF5JykpXG4gICAgICBBdWRpb0NvbnRleHQucHJvdG90eXBlLmNyZWF0ZURlbGF5ID0gQXVkaW9Db250ZXh0LnByb3RvdHlwZS5jcmVhdGVEZWxheU5vZGU7XG4gICAgaWYgKCFBdWRpb0NvbnRleHQucHJvdG90eXBlLmhhc093blByb3BlcnR5KCdjcmVhdGVTY3JpcHRQcm9jZXNzb3InKSlcbiAgICAgIEF1ZGlvQ29udGV4dC5wcm90b3R5cGUuY3JlYXRlU2NyaXB0UHJvY2Vzc29yID0gQXVkaW9Db250ZXh0LnByb3RvdHlwZS5jcmVhdGVKYXZhU2NyaXB0Tm9kZTtcbiAgICBpZiAoIUF1ZGlvQ29udGV4dC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkoJ2NyZWF0ZVBlcmlvZGljV2F2ZScpKVxuICAgICAgQXVkaW9Db250ZXh0LnByb3RvdHlwZS5jcmVhdGVQZXJpb2RpY1dhdmUgPSBBdWRpb0NvbnRleHQucHJvdG90eXBlLmNyZWF0ZVdhdmVUYWJsZTtcblxuXG4gICAgQXVkaW9Db250ZXh0LnByb3RvdHlwZS5pbnRlcm5hbF9jcmVhdGVHYWluID0gQXVkaW9Db250ZXh0LnByb3RvdHlwZS5jcmVhdGVHYWluO1xuICAgIEF1ZGlvQ29udGV4dC5wcm90b3R5cGUuY3JlYXRlR2FpbiA9IGZ1bmN0aW9uKCkgeyBcbiAgICAgIHZhciBub2RlID0gdGhpcy5pbnRlcm5hbF9jcmVhdGVHYWluKCk7XG4gICAgICBmaXhTZXRUYXJnZXQobm9kZS5nYWluKTtcbiAgICAgIHJldHVybiBub2RlO1xuICAgIH07XG5cbiAgICBBdWRpb0NvbnRleHQucHJvdG90eXBlLmludGVybmFsX2NyZWF0ZURlbGF5ID0gQXVkaW9Db250ZXh0LnByb3RvdHlwZS5jcmVhdGVEZWxheTtcbiAgICBBdWRpb0NvbnRleHQucHJvdG90eXBlLmNyZWF0ZURlbGF5ID0gZnVuY3Rpb24obWF4RGVsYXlUaW1lKSB7IFxuICAgICAgdmFyIG5vZGUgPSBtYXhEZWxheVRpbWUgPyB0aGlzLmludGVybmFsX2NyZWF0ZURlbGF5KG1heERlbGF5VGltZSkgOiB0aGlzLmludGVybmFsX2NyZWF0ZURlbGF5KCk7XG4gICAgICBmaXhTZXRUYXJnZXQobm9kZS5kZWxheVRpbWUpO1xuICAgICAgcmV0dXJuIG5vZGU7XG4gICAgfTtcblxuICAgIEF1ZGlvQ29udGV4dC5wcm90b3R5cGUuaW50ZXJuYWxfY3JlYXRlQnVmZmVyU291cmNlID0gQXVkaW9Db250ZXh0LnByb3RvdHlwZS5jcmVhdGVCdWZmZXJTb3VyY2U7XG4gICAgQXVkaW9Db250ZXh0LnByb3RvdHlwZS5jcmVhdGVCdWZmZXJTb3VyY2UgPSBmdW5jdGlvbigpIHsgXG4gICAgICB2YXIgbm9kZSA9IHRoaXMuaW50ZXJuYWxfY3JlYXRlQnVmZmVyU291cmNlKCk7XG4gICAgICBpZiAoIW5vZGUuc3RhcnQpIHtcbiAgICAgICAgbm9kZS5zdGFydCA9IGZ1bmN0aW9uICggd2hlbiwgb2Zmc2V0LCBkdXJhdGlvbiApIHtcbiAgICAgICAgICBpZiAoIG9mZnNldCB8fCBkdXJhdGlvbiApXG4gICAgICAgICAgICB0aGlzLm5vdGVHcmFpbk9uKCB3aGVuLCBvZmZzZXQsIGR1cmF0aW9uICk7XG4gICAgICAgICAgZWxzZVxuICAgICAgICAgICAgdGhpcy5ub3RlT24oIHdoZW4gKTtcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIGlmICghbm9kZS5zdG9wKVxuICAgICAgICBub2RlLnN0b3AgPSBub2RlLm5vdGVPZmY7XG4gICAgICBmaXhTZXRUYXJnZXQobm9kZS5wbGF5YmFja1JhdGUpO1xuICAgICAgcmV0dXJuIG5vZGU7XG4gICAgfTtcblxuICAgIEF1ZGlvQ29udGV4dC5wcm90b3R5cGUuaW50ZXJuYWxfY3JlYXRlRHluYW1pY3NDb21wcmVzc29yID0gQXVkaW9Db250ZXh0LnByb3RvdHlwZS5jcmVhdGVEeW5hbWljc0NvbXByZXNzb3I7XG4gICAgQXVkaW9Db250ZXh0LnByb3RvdHlwZS5jcmVhdGVEeW5hbWljc0NvbXByZXNzb3IgPSBmdW5jdGlvbigpIHsgXG4gICAgICB2YXIgbm9kZSA9IHRoaXMuaW50ZXJuYWxfY3JlYXRlRHluYW1pY3NDb21wcmVzc29yKCk7XG4gICAgICBmaXhTZXRUYXJnZXQobm9kZS50aHJlc2hvbGQpO1xuICAgICAgZml4U2V0VGFyZ2V0KG5vZGUua25lZSk7XG4gICAgICBmaXhTZXRUYXJnZXQobm9kZS5yYXRpbyk7XG4gICAgICBmaXhTZXRUYXJnZXQobm9kZS5yZWR1Y3Rpb24pO1xuICAgICAgZml4U2V0VGFyZ2V0KG5vZGUuYXR0YWNrKTtcbiAgICAgIGZpeFNldFRhcmdldChub2RlLnJlbGVhc2UpO1xuICAgICAgcmV0dXJuIG5vZGU7XG4gICAgfTtcblxuICAgIEF1ZGlvQ29udGV4dC5wcm90b3R5cGUuaW50ZXJuYWxfY3JlYXRlQmlxdWFkRmlsdGVyID0gQXVkaW9Db250ZXh0LnByb3RvdHlwZS5jcmVhdGVCaXF1YWRGaWx0ZXI7XG4gICAgQXVkaW9Db250ZXh0LnByb3RvdHlwZS5jcmVhdGVCaXF1YWRGaWx0ZXIgPSBmdW5jdGlvbigpIHsgXG4gICAgICB2YXIgbm9kZSA9IHRoaXMuaW50ZXJuYWxfY3JlYXRlQmlxdWFkRmlsdGVyKCk7XG4gICAgICBmaXhTZXRUYXJnZXQobm9kZS5mcmVxdWVuY3kpO1xuICAgICAgZml4U2V0VGFyZ2V0KG5vZGUuZGV0dW5lKTtcbiAgICAgIGZpeFNldFRhcmdldChub2RlLlEpO1xuICAgICAgZml4U2V0VGFyZ2V0KG5vZGUuZ2Fpbik7XG4gICAgICByZXR1cm4gbm9kZTtcbiAgICB9O1xuXG4gICAgaWYgKEF1ZGlvQ29udGV4dC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkoICdjcmVhdGVPc2NpbGxhdG9yJyApKSB7XG4gICAgICBBdWRpb0NvbnRleHQucHJvdG90eXBlLmludGVybmFsX2NyZWF0ZU9zY2lsbGF0b3IgPSBBdWRpb0NvbnRleHQucHJvdG90eXBlLmNyZWF0ZU9zY2lsbGF0b3I7XG4gICAgICBBdWRpb0NvbnRleHQucHJvdG90eXBlLmNyZWF0ZU9zY2lsbGF0b3IgPSBmdW5jdGlvbigpIHsgXG4gICAgICAgIHZhciBub2RlID0gdGhpcy5pbnRlcm5hbF9jcmVhdGVPc2NpbGxhdG9yKCk7XG4gICAgICAgIGlmICghbm9kZS5zdGFydClcbiAgICAgICAgICBub2RlLnN0YXJ0ID0gbm9kZS5ub3RlT247IFxuICAgICAgICBpZiAoIW5vZGUuc3RvcClcbiAgICAgICAgICBub2RlLnN0b3AgPSBub2RlLm5vdGVPZmY7XG4gICAgICAgIGlmICghbm9kZS5zZXRQZXJpb2RpY1dhdmUpXG4gICAgICAgICAgbm9kZS5zZXRQZXJpb2RpY1dhdmUgPSBub2RlLnNldFdhdmVUYWJsZTtcbiAgICAgICAgZml4U2V0VGFyZ2V0KG5vZGUuZnJlcXVlbmN5KTtcbiAgICAgICAgZml4U2V0VGFyZ2V0KG5vZGUuZGV0dW5lKTtcbiAgICAgICAgcmV0dXJuIG5vZGU7XG4gICAgICB9O1xuICAgIH1cbiAgfVxufSh3aW5kb3cpKTsiLCIvKmdsb2JhbHMgQXVkaW9Db250ZXh0Ki9cbnJlcXVpcmUoJy4vYWMtbW9ua2V5cGF0Y2gnKTtcbm1vZHVsZS5leHBvcnRzID0gbmV3IEF1ZGlvQ29udGV4dCgpOyIsIi8qIHdyaXR0ZW4gaW4gRUNNQXNjcmlwdCA2ICovXG4vKipcbiAqIEBmaWxlb3ZlcnZpZXcgV0FWRSBhdWRpbyB0aW1lIGVuZ2luZSBiYXNlIGNsYXNzXG4gKiBAYXV0aG9yIE5vcmJlcnQuU2NobmVsbEBpcmNhbS5mciwgVmljdG9yLlNhaXpAaXJjYW0uZnIsIEthcmltLkJhcmthdGlAaXJjYW0uZnJcbiAqL1xuXCJ1c2Ugc3RyaWN0XCI7XG5cbnZhciBhdWRpb0NvbnRleHQgPSByZXF1aXJlKFwiYXVkaW8tY29udGV4dFwiKTtcblxuLyoqXG4gKiBAY2xhc3MgVGltZUVuZ2luZVxuICogQGNsYXNzZGVzYyBCYXNlIGNsYXNzIGZvciB0aW1lIGVuZ2luZXNcbiAqXG4gKiBUaW1lIGVuZ2luZXMgYXJlIGNvbXBvbmVudHMgdGhhdCBnZW5lcmF0ZSBtb3JlIG9yIGxlc3MgcmVndWxhciBhdWRpbyBldmVudHMgYW5kL29yIHBsYXliYWNrIGEgbWVkaWEgc3RyZWFtLlxuICogVGhleSBpbXBsZW1lbnQgb25lIG9yIG11bHRpcGxlIGludGVyZmFjZXMgdG8gYmUgc3luY2hyb25pemVkIGJ5IGEgbWFzdGVyIHN1Y2ggYXMgYSBzY2hlZHVsZXIsIGEgdHJhbnNwb3J0IG9yIGEgcGxheS1jb250cm9sLlxuICogVGhlIHByb3ZpZGVkIGludGVyZmFjZXMgYXJlIFwic2NoZWR1bGVkXCIsIFwidHJhbnNwb3J0ZWRcIiwgYW5kIFwicGxheS1jb250cm9sbGVkXCIuXG4gKlxuICogSW4gdGhlIFwic2NoZWR1bGVkXCIgaW50ZXJmYWNlIHRoZSBlbmdpbmUgaW1wbGVtZW50cyBhIG1ldGhvZCBcImFkdmFuY2VUaW1lXCIgdGhhdCBpcyBjYWxsZWQgYnkgdGhlIG1hc3RlciAodXN1YWxseSB0aGUgc2NoZWR1bGVyKVxuICogYW5kIHJldHVybnMgdGhlIGRlbGF5IHVudGlsIHRoZSBuZXh0IGNhbGwgb2YgXCJhZHZhbmNlVGltZVwiLiBUaGUgbWFzdGVyIHByb3ZpZGVzIHRoZSBlbmdpbmUgd2l0aCBhIGZ1bmN0aW9uIFwicmVzZXROZXh0VGltZVwiXG4gKiB0byByZXNjaGVkdWxlIHRoZSBuZXh0IGNhbGwgdG8gYW5vdGhlciB0aW1lLlxuICpcbiAqIEluIHRoZSBcInRyYW5zcG9ydGVkXCIgaW50ZXJmYWNlIHRoZSBtYXN0ZXIgKHVzdWFsbHkgYSB0cmFuc3BvcnQpIGZpcnN0IGNhbGxzIHRoZSBtZXRob2QgXCJzeW5jUG9zaXRpb25cIiB0aGF0IHJldHVybnMgdGhlIHBvc2l0aW9uXG4gKiBvZiB0aGUgZmlyc3QgZXZlbnQgZ2VuZXJhdGVkIGJ5IHRoZSBlbmdpbmUgcmVnYXJkaW5nIHRoZSBwbGF5aW5nIGRpcmVjdGlvbiAoc2lnbiBvZiB0aGUgc3BlZWQgYXJndW1lbnQpLiBFdmVudHMgYXJlIGdlbmVyYXRlZFxuICogdGhyb3VnaCB0aGUgbWV0aG9kIFwiYWR2YW5jZVBvc2l0aW9uXCIgdGhhdCByZXR1cm5zIHRoZSBwb3NpdGlvbiBvZiB0aGUgbmV4dCBldmVudCBnZW5lcmF0ZWQgdGhyb3VnaCBcImFkdmFuY2VQb3NpdGlvblwiLlxuICpcbiAqIEluIHRoZSBcInNwZWVkLWNvbnRyb2xsZWRcIiBpbnRlcmZhY2UgdGhlIGVuZ2luZSBpcyBjb250cm9sbGVkIGJ5IHRoZSBtZXRob2QgXCJzeW5jU3BlZWRcIi5cbiAqXG4gKiBGb3IgYWxsIGludGVyZmFjZXMgdGhlIGVuZ2luZSBpcyBwcm92aWRlZCB3aXRoIHRoZSBhdHRyaWJ1dGUgZ2V0dGVycyBcImN1cnJlbnRUaW1lXCIgYW5kIFwiY3VycmVudFBvc2l0aW9uXCIgKGZvciB0aGUgY2FzZSB0aGF0IHRoZSBtYXN0ZXJcbiAqIGRvZXMgbm90IGltcGxlbWVudCB0aGVzZSBhdHRyaWJ1dGUgZ2V0dGVycywgdGhlIGJhc2UgY2xhc3MgcHJvdmlkZXMgZGVmYXVsdCBpbXBsZW1lbnRhdGlvbnMpLlxuICovXG5jbGFzcyBUaW1lRW5naW5lIHtcblxuICAvKipcbiAgICogQGNvbnN0cnVjdG9yXG4gICAqL1xuICBjb25zdHJ1Y3RvcigpIHtcblxuICAgIC8qKlxuICAgICAqIEludGVyZmFjZSBjdXJyZW50bHkgdXNlZFxuICAgICAqIEB0eXBlIHtTdHJpbmd9XG4gICAgICovXG4gICAgdGhpcy5pbnRlcmZhY2UgPSBudWxsO1xuXG4gICAgLyoqXG4gICAgICogT3V0cHV0IGF1ZGlvIG5vZGVcbiAgICAgKiBAdHlwZSB7T2JqZWN0fVxuICAgICAqL1xuICAgIHRoaXMub3V0cHV0Tm9kZSA9IG51bGw7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHRoZSB0aW1lIGVuZ2luZSdzIGN1cnJlbnQgbWFzdGVyIHRpbWVcbiAgICogQHR5cGUge0Z1bmN0aW9ufVxuICAgKlxuICAgKiBUaGlzIGZ1bmN0aW9uIHByb3ZpZGVkIGJ5IHRoZSBtYXN0ZXIuXG4gICAqL1xuICBnZXQgY3VycmVudFRpbWUoKSB7XG4gICAgcmV0dXJuIGF1ZGlvQ29udGV4dC5jdXJyZW50VGltZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIHRpbWUgZW5naW5lJ3MgY3VycmVudCBtYXN0ZXIgcG9zaXRpb25cbiAgICogQHR5cGUge0Z1bmN0aW9ufVxuICAgKlxuICAgKiBUaGlzIGZ1bmN0aW9uIHByb3ZpZGVkIGJ5IHRoZSBtYXN0ZXIuXG4gICAqL1xuICBnZXQgY3VycmVudFBvc2l0aW9uKCkge1xuICAgIHJldHVybiAwO1xuICB9XG5cbiAgLyoqXG4gICAqIEZ1bmN0aW9uIHByb3ZpZGVkIGJ5IHRoZSBzY2hlZHVsZXIgdG8gcmVzZXQgdGhlIGVuZ2luZSdzIG5leHQgdGltZVxuICAgKiBAcGFyYW0ge051bWJlcn0gdGltZSBuZXcgZW5naW5lIHRpbWUgKGltbWVkaWF0ZWx5IGlmIG5vdCBzcGVjaWZpZWQpXG4gICAqL1xuICByZXNldE5leHRUaW1lKHRpbWUgPSBudWxsKSB7fVxuXG4gIC8qKlxuICAgKiBGdW5jdGlvbiBwcm92aWRlZCBieSB0aGUgdHJhbnNwb3J0IHRvIHJlc2V0IHRoZSBuZXh0IHBvc2l0aW9uIG9yIHRvIHJlcXVlc3QgcmVzeW5jaHJvbml6aW5nIHRoZSBlbmdpbmUncyBwb3NpdGlvblxuICAgKiBAcGFyYW0ge051bWJlcn0gcG9zaXRpb24gbmV3IGVuZ2luZSBwb3NpdGlvbiAod2lsbCBjYWxsIHN5bmNQb3NpdGlvbiB3aXRoIHRoZSBjdXJyZW50IHBvc2l0aW9uIGlmIG5vdCBzcGVjaWZpZWQpXG4gICAqL1xuICByZXNldE5leHRQb3NpdGlvbihwb3NpdGlvbiA9IG51bGwpIHt9XG5cbiAgX19zZXRHZXR0ZXJzKGdldEN1cnJlbnRUaW1lLCBnZXRDdXJyZW50UG9zaXRpb24pIHtcbiAgICBpZiAoZ2V0Q3VycmVudFRpbWUpIHtcbiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCAnY3VycmVudFRpbWUnLCB7XG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgICAgZ2V0OiBnZXRDdXJyZW50VGltZVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgaWYgKGdldEN1cnJlbnRQb3NpdGlvbikge1xuICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsICdjdXJyZW50UG9zaXRpb24nLCB7XG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgICAgZ2V0OiBnZXRDdXJyZW50UG9zaXRpb25cbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIF9fZGVsZXRlR2V0dGVycygpIHtcbiAgICBkZWxldGUgdGhpcy5jdXJyZW50VGltZTtcbiAgICBkZWxldGUgdGhpcy5jdXJyZW50UG9zaXRpb247XG4gIH1cblxuICAvKipcbiAgICogQ29ubmVjdCBhdWRpbyBub2RlXG4gICAqIEBwYXJhbSB7T2JqZWN0fSB0YXJnZXQgYXVkaW8gbm9kZVxuICAgKi9cbiAgY29ubmVjdCh0YXJnZXQpIHtcbiAgICB0aGlzLm91dHB1dE5vZGUuY29ubmVjdCh0YXJnZXQpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgLyoqXG4gICAqIERpc2Nvbm5lY3QgYXVkaW8gbm9kZVxuICAgKiBAcGFyYW0ge051bWJlcn0gY29ubmVjdGlvbiBjb25uZWN0aW9uIHRvIGJlIGRpc2Nvbm5lY3RlZFxuICAgKi9cbiAgZGlzY29ubmVjdChjb25uZWN0aW9uKSB7XG4gICAgdGhpcy5vdXRwdXROb2RlLmRpc2Nvbm5lY3QoY29ubmVjdGlvbik7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cbn1cblxuLyoqXG4gKiBDaGVjayB3aGV0aGVyIHRoZSB0aW1lIGVuZ2luZSBpbXBsZW1lbnRzIHRoZSBzY2hlZHVsZWQgaW50ZXJmYWNlXG4gKiovXG5UaW1lRW5naW5lLmltcGxlbWVudHNTY2hlZHVsZWQgPSBmdW5jdGlvbihlbmdpbmUpIHtcbiAgcmV0dXJuIChlbmdpbmUuYWR2YW5jZVRpbWUgJiYgZW5naW5lLmFkdmFuY2VUaW1lIGluc3RhbmNlb2YgRnVuY3Rpb24pO1xufTtcblxuLyoqXG4gKiBDaGVjayB3aGV0aGVyIHRoZSB0aW1lIGVuZ2luZSBpbXBsZW1lbnRzIHRoZSB0cmFuc3BvcnRlZCBpbnRlcmZhY2VcbiAqKi9cblRpbWVFbmdpbmUuaW1wbGVtZW50c1RyYW5zcG9ydGVkID0gZnVuY3Rpb24oZW5naW5lKSB7XG4gIHJldHVybiAoXG4gICAgZW5naW5lLnN5bmNQb3NpdGlvbiAmJiBlbmdpbmUuc3luY1Bvc2l0aW9uIGluc3RhbmNlb2YgRnVuY3Rpb24gJiZcbiAgICBlbmdpbmUuYWR2YW5jZVBvc2l0aW9uICYmIGVuZ2luZS5hZHZhbmNlUG9zaXRpb24gaW5zdGFuY2VvZiBGdW5jdGlvblxuICApO1xufTtcblxuLyoqXG4gKiBDaGVjayB3aGV0aGVyIHRoZSB0aW1lIGVuZ2luZSBpbXBsZW1lbnRzIHRoZSBzcGVlZC1jb250cm9sbGVkIGludGVyZmFjZVxuICoqL1xuVGltZUVuZ2luZS5pbXBsZW1lbnRzU3BlZWRDb250cm9sbGVkID0gZnVuY3Rpb24oZW5naW5lKSB7XG4gIHJldHVybiAoZW5naW5lLnN5bmNTcGVlZCAmJiBlbmdpbmUuc3luY1NwZWVkIGluc3RhbmNlb2YgRnVuY3Rpb24pO1xufTtcblxuVGltZUVuZ2luZS5zZXRTY2hlZHVsZWQgPSBmdW5jdGlvbihlbmdpbmUsIHJlc2V0TmV4dFRpbWUsIGdldEN1cnJlbnRUaW1lLCBnZXRDdXJyZW50UG9zaXRpb24pIHtcbiAgZW5naW5lLmludGVyZmFjZSA9IFwic2NoZWR1bGVkXCI7XG4gIGVuZ2luZS5fX3NldEdldHRlcnMoZ2V0Q3VycmVudFRpbWUsIGdldEN1cnJlbnRQb3NpdGlvbik7XG4gIGlmIChyZXNldE5leHRUaW1lKVxuICAgIGVuZ2luZS5yZXNldE5leHRUaW1lID0gcmVzZXROZXh0VGltZTtcbn07XG5cblRpbWVFbmdpbmUuc2V0VHJhbnNwb3J0ZWQgPSBmdW5jdGlvbihlbmdpbmUsIHJlc2V0TmV4dFBvc2l0aW9uLCBnZXRDdXJyZW50VGltZSwgZ2V0Q3VycmVudFBvc2l0aW9uKSB7XG4gIGVuZ2luZS5pbnRlcmZhY2UgPSBcInRyYW5zcG9ydGVkXCI7XG4gIGVuZ2luZS5fX3NldEdldHRlcnMoZ2V0Q3VycmVudFRpbWUsIGdldEN1cnJlbnRQb3NpdGlvbik7XG4gIGlmIChyZXNldE5leHRQb3NpdGlvbilcbiAgICBlbmdpbmUucmVzZXROZXh0UG9zaXRpb24gPSByZXNldE5leHRQb3NpdGlvbjtcbn07XG5cblRpbWVFbmdpbmUuc2V0U3BlZWRDb250cm9sbGVkID0gZnVuY3Rpb24oZW5naW5lLCBnZXRDdXJyZW50VGltZSwgZ2V0Q3VycmVudFBvc2l0aW9uKSB7XG4gIGVuZ2luZS5pbnRlcmZhY2UgPSBcInNwZWVkLWNvbnRyb2xsZWRcIjtcbiAgZW5naW5lLl9fc2V0R2V0dGVycyhnZXRDdXJyZW50VGltZSwgZ2V0Q3VycmVudFBvc2l0aW9uKTtcbn07XG5cblRpbWVFbmdpbmUucmVzZXRJbnRlcmZhY2UgPSBmdW5jdGlvbihlbmdpbmUpIHtcbiAgZW5naW5lLl9fZGVsZXRlR2V0dGVycygpO1xuICBkZWxldGUgZW5naW5lLnJlc2V0TmV4dFRpbWU7XG4gIGRlbGV0ZSBlbmdpbmUucmVzZXROZXh0UG9zaXRpb247XG4gIGVuZ2luZS5pbnRlcmZhY2UgPSBudWxsO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBUaW1lRW5naW5lO1xuIl19
