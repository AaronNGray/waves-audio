!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.Transport=e()}}(function(){return function e(t,i,n){function s(r,_){if(!i[r]){if(!t[r]){var u="function"==typeof require&&require;if(!_&&u)return u(r,!0);if(o)return o(r,!0);throw new Error("Cannot find module '"+r+"'")}var a=i[r]={exports:{}};t[r][0].call(a.exports,function(e){var i=t[r][1][e];return s(i?i:e)},a,a.exports,e,t,i,n)}return i[r].exports}for(var o="function"==typeof require&&require,r=0;r<n.length;r++)s(n[r]);return s}({1:[function(e,t){"use strict";var i=function(){function e(){this.__objects=[],this.reverse=!1}function t(){return this.__objects[0][0]}var i=(function(e,t){return e.__proto__={a:t},e.a===t}({},{}),Object.defineProperty),n=Object.getOwnPropertyDescriptor,s=function(e,t){for(var s in t)t.hasOwnProperty(s)&&i(e,s,n(t,s));return e},o=Object.defineProperties,r={};return o(e.prototype,{head:{get:t,configurable:!0,enumerable:!0}}),i(e,"prototype",{configurable:!1,enumerable:!1,writable:!1}),r.__objectIndex=function(e){for(var t=0;t<this.__objects.length;t++)if(e===this.__objects[t][0])return t;return-1},r.__removeObject=function(e){var t=this.__objectIndex(e);return t>=0&&this.__objects.splice(t,1),this.__objects.length>0?this.__objects[0][1]:1/0},r.__sortObjects=function(){this.reverse?this.__objects.sort(function(e,t){return t[1]-e[1]}):this.__objects.sort(function(e,t){return e[1]-t[1]})},r.insert=function(e,t){var i=arguments[2];return void 0===i&&(i=!0),1/0!==t&&t!=-1/0?(this.__objects.push([e,t]),i&&this.__sortObjects(),this.__objects[0][1]):this.__removeObject(e)},r.move=function(e,t){if(1/0!==t&&t!=-1/0){var i=this.__objectIndex(e);return 0>i?this.__objects.push([e,t]):this.__objects[i][1]=t,this.__sortObjects(),this.__objects[0][1]}return this.__removeObject(e)},r.remove=function(e){return this.__removeObject(e)},r.clear=function(){return this.__objects.length=0,1/0},s(e.prototype,r),r=void 0,e}();t.exports=i},{}],2:[function(e,t){"use strict";var i=function(){function e(){this.__timeMaster=null,this.getMasterTime=function(){return 0},this.resetEngineTime=function(){},this.__positionMaster=null,this.__startPosition=0,this.getMasterPosition=function(){return 0},this.resyncEnginePosition=function(){},this.outputNode=null}function t(e){this.__timeMaster=e}function i(){return this.__timeMaster}function n(e){this.__positionMaster=e}function s(){return this.__positionMaster}function o(){return this.advanceTime&&this.advanceTime instanceof Function}function r(){return this.syncPosition&&this.syncPosition instanceof Function&&this.advancePosition&&this.advancePosition instanceof Function}function _(){return Object.getOwnPropertyDescriptor(Object.getPrototypeOf(this),"speed")&&this.seek&&this.seek instanceof Function}var u=Object.defineProperty,a=function(e,t){for(var i in t)t.hasOwnProperty(i)&&u(e,i,Object.getOwnPropertyDescriptor(t,i));return e},h={};return Object.defineProperties(e.prototype,{timeMaster:{get:i,set:t,configurable:!0,enumerable:!0},positionMaster:{get:s,set:n,configurable:!0,enumerable:!0},implementsTimeBased:{get:o,configurable:!0,enumerable:!0},implementsPositionBased:{get:r,configurable:!0,enumerable:!0},implementsSpeedBased:{get:_,configurable:!0,enumerable:!0}}),u(e,"prototype",{configurable:!1,enumerable:!1,writable:!1}),h.initTime=function(e){return e},h.connect=function(e){return this.outputNode.connect(e),this},h.disconnect=function(e){return this.outputNode.disconnect(e),this},a(e.prototype,h),h=void 0,e}();t.exports=i},{}],3:[function(e,t){"use strict";function i(e,t){var i=e.indexOf(t);return i>=0?(e.splice(i,1),!0):!1}var n=function(e,t){return e.__proto__={a:t},e.a===t}({},{}),s=Object.defineProperty,o=Object.getOwnPropertyDescriptor,r=function(e,t){for(var i in t)t.hasOwnProperty(i)&&s(e,i,o(t,i));return e},_=e("../time-engine"),u=e("../priority-queue"),a=(function(){function e(e){this.engine=e}return s(e,"prototype",{configurable:!1,enumerable:!1,writable:!1}),e}(),function(){function e(e){this.engine=e}return s(e,"prototype",{configurable:!1,enumerable:!1,writable:!1}),e}(),function(e){function t(e){if(e){if(Array.isArray(e))return 0;var t;if(P&&P(e),"object"==typeof e&&"function"==typeof(t=e[y]))return P&&P(void 0),t.call(e);if(P&&P(void 0),e+""=="[object Generator]")return e}throw new Error(e+" is not iterable")}function o(){e.call(this),this.__queue=new u,this.__positionEngines=[],this.__speedEngines=[],this.__timeEngines=[],this.__time=0,this.__position=0,this.__speed=0,this.__nextTime=1/0,this.__nextPosition=1/0,this.__playingSpeed=1}function _(){return this.__positionEngines.length+this.__speedEngines.length+this.__timeEngines.length}function a(){return this.getMasterTime()}function h(){return this.__positionMaster?this.getMasterPosition():this.getPositionAtTime(this.getMasterTime())}function c(e){var i,n,s,o;if(!this.timeMaster)throw new Error("no time master");var r=this.__speed;if(e!==r){this.__sync(),this.__speed=e;var _=this.__nextPosition;if(0===r||0>e*r)_=this.__resyncPositionEngines();else if(0===e){_=1/0,o=this.__timeEngines,i=t(o),s=0===i,n=s?o.length:void 0;for(var u;s?n>i:!(n=i.next()).done;)u=s?o[i++]:n.value,this.resetTime(u,1/0);i=n=s=o=void 0}this.__reschedule(_),o=this.__speedEngines,i=t(o),s=0===i,n=s?o.length:void 0;for(var a;s?n>i:!(n=i.next()).done;)a=s?o[i++]:n.value,a.speed=e;i=n=s=o=void 0}}function f(){return this.__speed}function p(e){e>=0?.0625>e?e=.0625:e>16&&(e=16):-16>e?e=-16:e>-.0625&&(e=-.0625),this.__playingSpeed=e,0!==this.__speed&&(this.speed=e)}function d(){return this.__playingSpeed}function l(e){var i,n,s,o,r;if(e){for(o=this.__timeEngines,i=t(o),s=0===i,n=s?o.length:void 0,r;s?n>i:!(n=i.next()).done;)r=s?o[i++]:n.value,e.add(r,1/0);i=n=s=o=void 0}else{for(o=this.__timeEngines,i=t(o),s=0===i,n=s?o.length:void 0,r;s?n>i:!(n=i.next()).done;)r=s?o[i++]:n.value,this.__timeMaster.remove(r);i=n=s=o=void 0}this.__timeMaster=e}function m(){return this.__timeMaster}var g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},v=Object.create;n||r(o,e);var b={},y="undefined"!=typeof Symbol&&Symbol&&Symbol.iterator||"@@iterator",P="undefined"!=typeof Symbol&&Symbol&&Symbol.__setObjectSetter__;return null!==e&&g(o,e),o.prototype=v(null!==e?e.prototype:null,{constructor:{value:o,configurable:!0,writable:!0},numEngines:{get:_,configurable:!0,enumerable:!0},time:{get:a,configurable:!0,enumerable:!0},position:{get:h,configurable:!0,enumerable:!0},speed:{get:f,set:c,configurable:!0,enumerable:!0},playingSpeed:{get:d,set:p,configurable:!0,enumerable:!0},timeMaster:{get:m,set:l,configurable:!0,enumerable:!0}}),s(o,"prototype",{configurable:!1,enumerable:!1,writable:!1}),b.__sync=function(e){var t=e||this.getMasterTime();return this.__position+=(t-this.__time)*this.__speed,this.__time=t,t},b.__reschedule=function(e){var t=this.getTimeAtPosition(e);t!==this.__nextTime&&(this.resetEngineTime(t),this.__nextTime=t),this.__nextPosition=e},b.__resyncPositionEngines=function(){var e=this.__positionEngines.length,t=1/0;if(e>0){var i,n,s=this.__time,o=this.__position,r=this.__speed;this.__queue.clear(),this.__queue.reverse=0>r;for(var _=e-1;_>0;_--)i=this.__positionEngines[_],n=i.__startPosition+i.syncPosition(s,o-i.__startPosition,r),this.__queue.insert(i,n,!1);i=this.__positionEngines[0],n=i.__startPosition+i.syncPosition(s,o-i.__startPosition,r),t=this.__queue.insert(i,n,!0)}return t},b.initTime=function(){return 1/0},b.advanceTime=function(e){this.__sync(e);var t=this.__queue.head,i=t.__startPosition,n=i+t.advancePosition(e,this.__position-i,this.__speed),s=this.__queue.move(t,n),o=this.getTimeAtPosition(s);return this.__nextTime=o,o},b.syncPosition=function(e,i,n){var s,o,r,_;this.__time=i,this.__position=e,this.__speed=n,_=this.__speedEngines,s=t(_),r=0===s,o=r?_.length:void 0;for(var u;r?o>s:!(o=s.next()).done;)u=r?_[s++]:o.value,u.seek(e);s=o=r=_=void 0;var a=this.__resetAllEngines(i,e);return this.__nextPosition=a,a},b.advancePosition=function(e,t,i){this.__time=t,this.__position=e,this.__speed=i;var n=this.__queue.head,s=n.advancePosition(e,t,i),o=this.__queue.move(n,s);return this.__nextPosition=o,o},b.getTimeAtPosition=function(e){return this.__time+(e-this.__position)/this.__speed},b.getPositionAtTime=function(e){return this.__position+(e-this.__time)*this.__speed},b.seek=function(e){var i,n,s,o;if(e!==this.__position){this.__sync(),this.__position=e;var r=this.__speed;if(0!==r){var _=this.__resyncPositionEngines();this.__reschedule(_),o=this.__speedEngines,i=t(o),s=0===i,n=s?o.length:void 0;for(var u;s?n>i:!(n=i.next()).done;)u=s?o[i++]:n.value,u.seek(e);i=n=s=o=void 0}}},b.startPlaying=function(){var e=arguments[0];void 0===e&&(e=null);var t=arguments[1];void 0===t&&(t=null),e&&this.seek(e),t&&(this.playingSpeed=t),this.speed=this.playingSpeed},b.pausePlaying=function(){this.speed=0},b.stopPlaying=function(){this.speed=0,this.seek(0)},b.add=function(e){var t=arguments[1];void 0===t&&(t=0);var i=this;if(e.positionMaster||e.timeMaster)throw new Error("object already has a master");var n=this.__sync(),s=this.__speed;if(e.positionMaster=this,e.implementsPositionBased){if(this.__positionEngines.push(e),e.__startPosition=t,e.resyncEnginePosition=function(){var t=i.__sync(),n=i.__position,s=i.__speed;if(0!==s){var o=e.__startPosition+e.syncPosition(t,n-e.__startPosition,s),r=i.__queue.move(e,o);i.__reschedule(r)}},e.getMasterPosition=function(){return i.position-e.__startPosition},0!==s){var o=e.__startPosition+e.syncPosition(n,this.__position-e.__startPosition,s),r=this.__queue.insert(e,o);this.__reschedule(r)}}else if(e.implementsSpeedBased)this.__speedEngines.push(e),e.speed=s;else{if(!e.implementsTimeBased)throw new Error("object cannot be added to transport");this.__timeEngines.push(e),this.timeMaster&&this.timeMaster.add(e,1/0)}},b.remove=function(e){if(e.positionMaster!==this)throw new Error("object has not been added to this transport");this.__sync();if(e.positionMaster=null,e.implementsPositionBased){var t=this.__queue.remove(e);0!==this.__speed&&this.__reschedule(t),i(this.__positionEngines,e)}else e.implementsSpeedBased?(e.speed=0,i(this.__speedEngines,e)):e.implementsTimeBased&&(this.timeMaster&&this.timeMaster.remove(e),i(this.__timeEngines,e))},r(o.prototype,b),b=void 0,o}(_));t.exports=a},{"../priority-queue":1,"../time-engine":2}]},{},[3])(3)});