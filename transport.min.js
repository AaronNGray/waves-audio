!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.Transport=e()}}(function(){return function e(t,n,i){function r(o,_){if(!n[o]){if(!t[o]){var u="function"==typeof require&&require;if(!_&&u)return u(o,!0);if(s)return s(o,!0);throw new Error("Cannot find module '"+o+"'")}var c=n[o]={exports:{}};t[o][0].call(c.exports,function(e){var n=t[o][1][e];return r(n?n:e)},c,c.exports,e,t,n,i)}return n[o].exports}for(var s="function"==typeof require&&require,o=0;o<i.length;o++)r(i[o]);return r}({1:[function(e,t){var n=window.audioContext||new AudioContext||new webkitAudioContext;window.audioContext=n,t.exports=n},{}],2:[function(e,t){"use strict";var n=function(){function e(){this.__objects=[],this.reverse=!1}function t(){return this.__objects[0][0]}var n=(function(e,t){return e.__proto__={a:t},e.a===t}({},{}),Object.defineProperty),i=Object.getOwnPropertyDescriptor,r=function(e,t){for(var r in t)t.hasOwnProperty(r)&&n(e,r,i(t,r));return e},s=Object.defineProperties,o={};return s(e.prototype,{head:{get:t,configurable:!0,enumerable:!0}}),n(e,"prototype",{configurable:!1,enumerable:!1,writable:!1}),o.__objectIndex=function(e){for(var t=0;t<this.__objects.length;t++)if(e===this.__objects[t][0])return t;return-1},o.__removeObject=function(e){var t=this.__objectIndex(e);return t>=0&&this.__objects.splice(t,1),this.__objects.length>0?this.__objects[0][1]:1/0},o.__sortObjects=function(){this.reverse?this.__objects.sort(function(e,t){return t[1]-e[1]}):this.__objects.sort(function(e,t){return e[1]-t[1]})},o.insert=function(e,t){var n=arguments[2];return void 0===n&&(n=!0),1/0!==t&&t!=-1/0?(this.__objects.push([e,t]),n&&this.__sortObjects(),this.__objects[0][1]):this.__removeObject(e)},o.move=function(e,t){if(1/0!==t&&t!=-1/0){var n=this.__objectIndex(e);return 0>n?this.__objects.push([e,t]):this.__objects[n][1]=t,this.__sortObjects(),this.__objects[0][1]}return this.__removeObject(e)},o.remove=function(e){return this.__removeObject(e)},o.clear=function(){return this.__objects.length=0,1/0},r(e.prototype,o),o=void 0,e}();t.exports=n},{}],3:[function(e,t){"use strict";function n(e,t){var n=e.indexOf(t);return n>=0?(e.splice(n,1),!0):!1}var i=e("../audio-context"),r=e("../priority-queue"),s=(e("../time-engine"),function(){function e(){this.__queue=new r,this.__scheduledEngines=[],this.__currentTime=null,this.__nextTime=1/0,this.__timeout=null,this.period=.025,this.lookahead=.1}function t(){return this.__currentTime||i.currentTime+this.lookahead}var s=(function(e,t){return e.__proto__={a:t},e.a===t}({},{}),Object.defineProperty),o=Object.getOwnPropertyDescriptor,_=function(e,t){for(var n in t)t.hasOwnProperty(n)&&s(e,n,o(t,n));return e},u=Object.defineProperties,c={};return u(e.prototype,{currentTime:{get:t,configurable:!0,enumerable:!0}}),s(e,"prototype",{configurable:!1,enumerable:!1,writable:!1}),c.__tick=function(){for(var e=this;this.__nextTime<=i.currentTime+this.lookahead;){this.__currentTime=this.__nextTime;var t=this.__queue.head,n=Math.max(t.advanceTime(this.__currentTime),this.__currentTime);this.__nextTime=this.__queue.move(t,n)}this.__currentTime=null,this.__timeout=null,1/0!==this.__nextTime&&(this.__timeout=setTimeout(function(){e.__tick()},1e3*this.period))},c.__reschedule=function(){1/0!==this.__nextTime?this.__timeout||this.__tick():this.__timeout&&(clearTimeout(this.__timeout),this.__timeout=null)},c.callback=function(e){var t=arguments[1];void 0===t&&(t=0);var n=arguments[2];void 0===n&&(n=0);var i={period:t||1/0,executeNext:function(t,n){return e(t,n),t+this.period}};return this.__nextTime=this.__queue.insert(i,this.currentTime+n),this.__reschedule(),i},c.add=function(e){var t=arguments[1];void 0===t&&(t=0);var n=arguments[2];void 0===n&&(n=null);var i=this;if(e.master)throw new Error("object has already been added to a master");if(!e.implementsScheduled)throw new Error("object cannot be added to scheduler");this.__scheduledEngines.push(e),e.setScheduled(this,function(t){i.__nextTime=i.__queue.move(e,t),i.__reschedule()},function(){return i.currentTime},n),this.__nextTime=this.__queue.insert(e,this.currentTime+t),this.__reschedule()},c.remove=function(e){if(!n(this.__scheduledEngines,e))throw new Error("object has not been added to this scheduler");e.resetScheduled(),this.__nextTime=this.__queue.remove(e),this.__reschedule()},c.reset=function(e,t){if(e.master!==this)throw new Error("object has not been added to this scheduler");this.__nextTime=this.__queue.move(e,t),this.__reschedule()},_(e.prototype,c),c=void 0,e}());t.exports=new s},{"../audio-context":1,"../priority-queue":2,"../time-engine":4}],4:[function(e,t){"use strict";var n=e("../audio-context"),i=function(){function e(){this.master=null,this.interface=null,this.transportStartPosition=0,this.outputNode=null}function t(){return this.advanceTime&&this.advanceTime instanceof Function}function i(){return this.syncPosition&&this.syncPosition instanceof Function&&this.advancePosition&&this.advancePosition instanceof Function}function r(){return this.syncSpeed&&this.syncSpeed instanceof Function}function s(){return n.currentTime}function o(){return 0}var _=Object.defineProperty,u=function(e,t){for(var n in t)t.hasOwnProperty(n)&&_(e,n,Object.getOwnPropertyDescriptor(t,n));return e},c={};return Object.defineProperties(e.prototype,{implementsScheduled:{get:t,configurable:!0,enumerable:!0},implementsTransported:{get:i,configurable:!0,enumerable:!0},implementsSpeedControlled:{get:r,configurable:!0,enumerable:!0},currentTime:{get:s,configurable:!0,enumerable:!0},currentPosition:{get:o,configurable:!0,enumerable:!0}}),_(e,"prototype",{configurable:!1,enumerable:!1,writable:!1}),c.resetEngineTime=function(){},c.resyncEnginePosition=function(){},c.__setGetters=function(e,t){e&&Object.defineProperty(this,"currentTime",{configurable:!0,get:e,set:function(){}}),t&&Object.defineProperty(this,"currentPosition",{configurable:!0,get:t,set:function(){}})},c.__deleteGetters=function(){delete this.currentTime,delete this.currentPosition},c.setScheduled=function(e,t,n,i){this.master=e,this.interface="scheduled",this.__setGetters(n,i),t&&(this.resetEngineTime=t)},c.resetScheduled=function(){this.__deleteGetters(),delete this.resetEngineTime,this.master=null,this.interface=null},c.setTransported=function(e,t,n,i,r){this.master=e,this.interface="transported",this.transportStartPosition=t,this.__setGetters(i,r),n&&(this.resyncEnginePosition=n)},c.resetTransported=function(){this.__deleteGetters(),delete this.resyncEnginePosition,this.transportStartPosition=0,this.master=null,this.interface=null},c.setSpeedControlled=function(e,t,n){this.master=e,this.interface="speed-controlled",this.__setGetters(t,n)},c.resetSpeedControlled=function(){this.__deleteGetters(),this.master=null,this.interface=null},c.removeFromMaster=function(){this.master&&this.master.remove(this)},c.connect=function(e){return this.outputNode.connect(e),this},c.disconnect=function(e){return this.outputNode.disconnect(e),this},u(e.prototype,c),c=void 0,e}();t.exports=i},{"../audio-context":1}],5:[function(e,t){"use strict";function n(e,t){var n=e.indexOf(t);return n>=0?(e.splice(n,1),!0):!1}var i=function(e,t){return e.__proto__={a:t},e.a===t}({},{}),r=Object.defineProperty,s=Object.getOwnPropertyDescriptor,o=function(e,t){for(var n in t)t.hasOwnProperty(n)&&r(e,n,s(t,n));return e},_=e("../time-engine"),u=e("../priority-queue"),c=e("../scheduler"),h=(function(){function e(e){this.engine=e}return r(e,"prototype",{configurable:!1,enumerable:!1,writable:!1}),e}(),function(){function e(e){this.engine=e}return r(e,"prototype",{configurable:!1,enumerable:!1,writable:!1}),e}(),function(e){function t(e){if(e){if(Array.isArray(e))return 0;var t;if(g&&g(e),"object"==typeof e&&"function"==typeof(t=e[v]))return g&&g(void 0),t.call(e);if(g&&g(void 0),e+""=="[object Generator]")return e}throw new Error(e+" is not iterable")}function s(){e.call(this),this.__queue=new u,this.__transportedEngines=[],this.__speedControlledEngines=[],this.__scheduledEngines=[],this.__time=0,this.__position=0,this.__speed=0,this.__nextTime=1/0,this.__nextPosition=1/0,this.__playingSpeed=1}function _(){return this.__transportedEngines.length+this.__speedControlledEngines.length+this.__scheduledEngines.length}function h(){return c.currentTime}function d(){return this.getPositionAtTime(this.currentTime)}function a(e){var t=this.__sync();e>=0?.0625>e?e=.0625:e>16&&(e=16):-16>e?e=-16:e>-.0625&&(e=-.0625),this.__playingSpeed=e,0!==this.__speed&&this.syncSpeed(t,this.__position,e)}function l(){return this.__playingSpeed}var p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},f=Object.create;i||o(s,e);var m={},v="undefined"!=typeof Symbol&&Symbol&&Symbol.iterator||"@@iterator",g="undefined"!=typeof Symbol&&Symbol&&Symbol.__setObjectSetter__;return null!==e&&p(s,e),s.prototype=f(null!==e?e.prototype:null,{constructor:{value:s,configurable:!0,writable:!0},numEngines:{get:_,configurable:!0,enumerable:!0},currentTime:{get:h,configurable:!0,enumerable:!0},currentPosition:{get:d,configurable:!0,enumerable:!0},speed:{get:l,set:a,configurable:!0,enumerable:!0}}),r(s,"prototype",{configurable:!1,enumerable:!1,writable:!1}),m.__sync=function(e){var t=e||this.currentTime;return this.__position+=(t-this.__time)*this.__speed,this.__time=t,t},m.__resyncTransportedEngines=function(){var e=this.__transportedEngines.length,t=1/0;if(e>0){var n,i,r=this.__time,s=this.__position,o=this.__speed;this.__queue.clear(),this.__queue.reverse=0>o;for(var _=e-1;_>0;_--)n=this.__transportedEngines[_],i=n.transportStartPosition+n.syncPosition(r,s-n.transportStartPosition,o),this.__queue.insert(n,i,!1);n=this.__transportedEngines[0],i=n.transportStartPosition+n.syncPosition(r,s-n.transportStartPosition,o),t=this.__queue.insert(n,i,!0)}return t},m.__rescheduleAccordingToPosition=function(e){var t=this.getTimeAtPosition(e);t!==this.__nextTime&&(1/0===t?c.remove(this):this.master?this.resetEngineTime(t):c.add(this,t-c.currentTime,"its me!"),this.__nextTime=t),this.__nextPosition=e},m.advanceTime=function(e){this.__sync(e);var t=this.__queue.head,n=t.transportStartPosition+t.advancePosition(e,this.__position-t.transportStartPosition,this.__speed),i=this.__queue.move(t,n),r=this.getTimeAtPosition(i);return this.__nextTime=r,r},m.syncPosition=function(e,n,i){var r,s,o,_;this.__time=e,this.__position=n,this.__speed=i,_=this.__speedControlledEngines,r=t(_),o=0===r,s=o?_.length:void 0;for(var u;o?s>r:!(s=r.next()).done;)u=o?_[r++]:s.value,u.syncSpeed(e,n,0),u.syncSpeed(e,n,i);r=s=o=_=void 0;var c=this.__resetAllEngines(e,n);return this.__nextPosition=c,c},m.advancePosition=function(e,t,n){this.__time=e,this.__position=t,this.__speed=n;var i=this.__queue.head,r=i.advancePosition(t,e,n),s=this.__queue.move(i,r);return this.__nextPosition=s,s},m.syncSpeed=function(e,n,i){var r,s,o,_;if("transported"===this.interface)throw new Error("no scheduler");var u=this.__speed;if(i!==u){this.__speed=i;var c,h=this.__nextPosition;if(0===u){for(h=this.__resyncTransportedEngines(),_=this.__scheduledEngines,r=t(_),o=0===r,s=o?_.length:void 0,c;o?s>r:!(s=r.next()).done;)c=o?_[r++]:s.value,c.resetEngineTime(0);r=s=o=_=void 0}else if(0===i){for(h=1/0,_=this.__scheduledEngines,r=t(_),o=0===r,s=o?_.length:void 0,c;o?s>r:!(s=r.next()).done;)c=o?_[r++]:s.value,c.resetEngineTime(1/0);r=s=o=_=void 0}else 0>i*u&&(h=this.__resyncTransportedEngines());this.__rescheduleAccordingToPosition(h),_=this.__speedControlledEngines,r=t(_),o=0===r,s=o?_.length:void 0;for(var d;o?s>r:!(s=r.next()).done;)d=o?_[r++]:s.value,d.syncSpeed(e,n,i);r=s=o=_=void 0}},m.getTimeAtPosition=function(e){return this.__time+(e-this.__position)/this.__speed},m.getPositionAtTime=function(e){return this.__position+(e-this.__time)*this.__speed},m.start=function(){var e=this.__sync();this.syncSpeed(e,this.__position,this.__playingSpeed)},m.pause=function(){var e=this.__sync();this.syncSpeed(e,this.__position,0)},m.stop=function(){var e=this.__sync();this.syncSpeed(e,this.__position,0),this.seek(0)},m.seek=function(e){var n,i,r,s;if(e!==this.__position){var o=this.__sync(),_=this.__speed;if(0!==_){var u=this.__resyncTransportedEngines();this.__rescheduleAccordingToPosition(u),s=this.__speedControlledEngines,n=t(s),r=0===n,i=r?s.length:void 0;for(var c;r?i>n:!(i=n.next()).done;)c=r?s[n++]:i.value,c.syncSpeed(o,this.__position,0),c.syncSpeed(o,e,_);n=i=r=s=void 0}this.__position=e}},m.add=function(e){var t=arguments[1];void 0===t&&(t=0);var n=this;if(e.master)throw new Error("object has already been added to a master");var i=this.__sync(),r=this.__speed,s=function(){return n.currentTime},o=function(){return n.currentPosition-t};if(e.implementsTransported){if(this.__transportedEngines.push(e),e.setTransported(this,t,function(){var t=n.__sync(),i=n.__speed;if(0!==i){var r=e.transportStartPosition+e.syncPosition(t,n.__position-e.transportStartPosition,i),s=n.__queue.move(e,r);n.__rescheduleAccordingToPosition(s)}},s,o),0!==r){var _=e.transportStartPosition+e.syncPosition(i,this.__position-e.transportStartPosition,r),u=this.__queue.insert(e,_);this.__rescheduleAccordingToPosition(u)}}else if(e.implementsSpeedControlled)this.__speedControlledEngines.push(e),e.setSpeedControlled(this,s,o),e.syncSpeed(i,this.__position,r);else{if(!e.implementsScheduled)throw new Error("object cannot be added to transport");this.__scheduledEngines.push(e);var h=0!==this.__speed?0:1/0;c.add(e,h,o)}},m.remove=function(e){var t=this.__sync();if(e.implementsTransported&&n(this.__transportedEngines,e)){var i=this.__queue.remove(e);0!==this.__speed&&this.__rescheduleAccordingToPosition(i),e.resetTransported()}else if(e.implementsSpeedControlled&&n(this.__speedControlledEngines,e))e.syncSpeed(t,this.__position,0),e.resetSpeedControlled();else{if(!e.implementsScheduled||!n(this.__scheduledEngines,e))throw new Error("object has not been added to this transport");c.remove(e),e.resetScheduled()}},m.clear=function(){var e,n,i,r,s=this.__sync();("scheduled"===this.interface||"speed-controlled"===this.interface)&&this.syncSpeed(s,this.__position,0),r=this.__transportedEngines,e=t(r),i=0===e,n=i?r.length:void 0;for(var o;i?n>e:!(n=e.next()).done;)o=i?r[e++]:n.value,o.resetTransported();e=n=i=r=void 0,r=this.__speedControlledEngines,e=t(r),i=0===e,n=i?r.length:void 0;for(var _;i?n>e:!(n=e.next()).done;)_=i?r[e++]:n.value,_.resetSpeedControlled();e=n=i=r=void 0,r=this.__scheduledEngines,e=t(r),i=0===e,n=i?r.length:void 0;for(var u;i?n>e:!(n=e.next()).done;)u=i?r[e++]:n.value,u.resetScheduled();e=n=i=r=void 0,this.__transportedEngines.length=0,this.__speedControlledEngines.length=0,this.__scheduledEngines.length=0,"transported"===this.interface&&this.resyncEnginePosition()},m.setScheduled=function(t,n,i,r){if("its me!"!==r)throw new Error("Transport cannot be added to scheduler");e.prototype.setScheduled.call(this,t,n,i,null)},o(s.prototype,m),m=void 0,s}(_));t.exports=h},{"../priority-queue":2,"../scheduler":3,"../time-engine":4}]},{},[5])(5)});